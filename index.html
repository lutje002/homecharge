<!DOCTYPE html>
<html>
<head>
  <title>NCubed Invoice Generator</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ... [previous CSS remains the same] ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>NCubed Factuur Generator</h1>
    <p>Upload een screenshot van de laadsessies:</p>
    <input type="file" id="photoInput" accept="image/*">
    <button onclick="processImage()">Genereer Factuur</button>
    <div id="invoiceContainer" style="display: none;">
      <!-- ... [previous HTML structure remains the same] ... -->
    </div>
  </div>

  <script>
    async function processImage() {
      const photoInput = document.getElementById('photoInput');
      const invoiceContainer = document.getElementById('invoiceContainer');

      if (photoInput.files.length > 0) {
        const file = photoInput.files[0];
        
        // Converteer de afbeelding naar base64
        const base64Image = await convertToBase64(file);

        try {
          const response = await fetch('https://openapi.monica.im/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer sk-74PDyAlNKWSTMSF00qpvh0Z0WuGzpriVmWDBdMAUHED9PSmGLcMCZ4ByElHRwX7ch8wgghmnusYT2Zcb2QLpRbaG_heD'
            },
            body: JSON.stringify({
              model: "gpt-4o",
              messages: [
                {
                  role: "user",
                  content: [
                    {
                      type: "text",
                      text: "Analyseer deze afbeelding van laadsessies en extraheer de datum, kWh en prijs per kWh"
                    },
                    {
                      type: "image",
                      image: base64Image
                    }
                  ]
                }
              ]
            })
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log('API Response:', data);

          // Verwerk het antwoord en update de factuur
          // Dit deel moet worden aangepast op basis van de werkelijke API response
          const invoiceBody = document.getElementById('invoiceBody');
          invoiceBody.innerHTML = ''; 

          let totalAmount = 0;

          // Voorbeeld van hoe je de data zou kunnen verwerken
          // Pas dit aan op basis van de werkelijke API response structuur
          if (data.sessions) {
            data.sessions.forEach(session => {
              const row = document.createElement('tr');
              const amount = session.kWh * session.pricePerKWh;

              row.innerHTML = `
                <td>${session.date}</td>
                <td>Thuisladen elektrische auto</td>
                <td>${session.kWh}</td>
                <td>€${session.pricePerKWh.toFixed(2)}</td>
                <td>€${amount.toFixed(2)}</td>
              `;
              
              invoiceBody.appendChild(row);
              totalAmount += amount;
            });
          }

          document.getElementById('invoiceTotal').textContent = '€' + totalAmount.toFixed(2);
          invoiceContainer.style.display = 'block';

        } catch (error) {
          console.error('Error:', error);
          alert('Er is een fout opgetreden bij het verwerken van de afbeelding: ' + error.message);
        }
      }
    }

    // Helper functie om een bestand naar base64 te converteren
    function convertToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }

    // ... [previous PDF generation functions remain the same] ...
  </script>
</body>
</html>
